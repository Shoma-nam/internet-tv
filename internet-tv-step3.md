# ステップ3
以下のデータを抽出するクエリを書いてください。  

1. よく見られているエピソードを知りたいです。エピソード視聴数トップ3のエピソードタイトルと視聴数を取得してください  

    ```bash
    SELECT 
        title,viewership 
    FROM 
        episodes 
    ORDER BY 
        viewership DESC 
    LIMIT 3;  
    ```

    ```bash
    +-----------------------+------------+
    | title                 | viewership |
    +-----------------------+------------+
    | 幽霊屋敷の真実          |     600000 |
    | 怪盗の挑戦             |     550000 |
    | 夜明けの出会い          |     500000 |
    +-----------------------+------------+
    3 rows in set (0.01 sec)
    ```

2. よく見られているエピソードの番組情報やシーズン情報も合わせて知りたいです。  
    エピソード視聴数トップ3の番組タイトル、シーズン数、エピソード数、エピソードタイトル、視聴数を取得してください  

    ```bash
    SELECT  
        p.title AS program_title,
        s.season_number,
        e.episode_number,
        e.title AS episode_title,
        e.viewership
    FROM  
        episodes e
        JOIN series s ON e.series_id = s.series_id
        JOIN programs p ON s.series_id = p.series_id
    ORDER BY  
        e.viewership DESC
    LIMIT 3;  
    ```

    ```bash
    +-----------------+---------------+----------------+-----------------------+------------+
    | program_title   | season_number | episode_number | episode_title         | viewership |
    +-----------------+---------------+----------------+-----------------------+------------+
    | 怪盗の謎         |             3 |              1 | 怪盗の挑戦              |     550000 |
    | 夜明けの街       |             3 |              1 | 夜明けの出会い           |     500000 |
    | 未来への旅       |             1 |              1 | 時間を超えて             |     500000 |
    +-----------------+---------------+----------------+-----------------------+------------+
    3 rows in set (0.04 sec)
    ```

3. 本日の番組表を表示するために、本日、どのチャンネルの、何時から、何の番組が放送されるのかを知りたいです。  
   本日放送される全ての番組に対して、チャンネル名、放送開始時刻(日付+時間)、放送終了時刻、シーズン数、エピソード数、エピソードタイトル、エピソード詳細を取得してください。  
   なお、番組の開始時刻が本日のものを本日放送される番組とみなすものとします.  

    ```bash
    SELECT 
        bs.start_time,
        bs.end_time,
        s.season_number,
        e.episode_number,
        e.title AS episode_title,
        e.description
    FROM 
        broadcast_schedule bs
        JOIN channels c ON bs.channel_id = c.channel_id
        JOIN episodes e ON bs.episode_id = e.episode_id
        JOIN series s ON e.series_id = s.series_id
    WHERE 
        c.channel_name = 'ドラマ'
        AND bs.start_time BETWEEN CURDATE() AND CURDATE() + INTERVAL 7 DAY
    ORDER BY 
        bs.start_time;
    ```

    ```bash
    +-----------------------------------+---------------------+---------------------+---------------+----------------+-----------------------------------+--------------------------------------------------------------------+
    | channel_name                      | start_time          | end_time            | season_number | episode_number | episode_title                     | description                                                        |
    +-----------------------------------+---------------------+---------------------+---------------+----------------+-----------------------------------+--------------------------------------------------------------------+
    | ミュージカルチャンネル            | 2023-11-12 17:00:00 | 2023-11-12 17:45:00 |             5 |              1 | 新しい地平へ                      | 海を越えた冒険の始まり。                                           |
    | スポーツチャンネル                | 2023-11-12 18:30:00 | 2023-11-12 19:00:00 |             1 |              1 | 秘密の花園の発見                  | 古い屋敷の隠された花園を見つける物語。                             |
    | ドラマチャンネル                  | 2023-11-12 19:00:00 | 2023-11-12 19:45:00 |             3 |              1 | 夜明けの出会い                    | 新しい都市での生活が始まる主人公の物語。                           |
    | アニメチャンネル                  | 2023-11-12 20:00:00 | 2023-11-12 20:40:00 |             2 |              1 | 星への旅立ち                      | 若き宇宙飛行士が最初のミッションに挑む。                           |
    | 映画チャンネル                    | 2023-11-12 20:00:00 | 2023-11-12 21:00:00 |             6 |              1 | 幽霊屋敷の真実                    | 幽霊屋敷の秘密に迫る。                                             |
    | ドラマチャンネル                  | 2023-11-12 21:00:00 | 2023-11-12 21:40:00 |             2 |              1 | 宇宙ステーションの日常            | 宇宙ステーションでの生活を紹介。                                   |
    | 映画チャンネル                    | 2023-11-12 21:00:00 | 2023-11-12 21:55:00 |             4 |              1 | サイバー犯罪の謎                  | 高度なサイバー技術を使った犯罪に立ち向かう。                       |
    | アニメチャンネル                  | 2023-11-12 22:00:00 | 2023-11-12 22:50:00 |             3 |              1 | 怪盗の挑戦                        | 巧妙な怪盗による盗みの計画。                                       |
    | スポーツチャンネル                | 2023-11-12 23:00:00 | 2023-11-12 23:55:00 |             1 |              1 | 時間を超えて                      | 時間旅行の不思議と冒険。                                           |
    +-----------------------------------+---------------------+---------------------+---------------+----------------+-----------------------------------+--------------------------------------------------------------------+
    9 rows in set (0.00 sec)
    ```

4. ドラマというチャンネルがあったとして、ドラマのチャンネルの番組表を表示するために、本日から一週間分、何日の何時から何の番組が放送されるのかを知りたいです。  
   ドラマのチャンネルに対して、放送開始時刻、放送終了時刻、シーズン数、エピソード数、エピソードタイトル、エピソード詳細を本日から一週間分取得してください.  

    ```bash
    SELECT 
        bs.start_time,
        bs.end_time,
        s.season_number,
        e.episode_number,
        e.title AS episode_title,
        e.description
    FROM 
        broadcast_schedule bs
        JOIN channels c ON bs.channel_id = c.channel_id
        JOIN episodes e ON bs.episode_id = e.episode_id
        JOIN series s ON e.series_id = s.series_id
    WHERE 
        c.channel_id = 1
        AND bs.start_time BETWEEN CURDATE() AND CURDATE() + INTERVAL 7 DAY
    ORDER BY 
        bs.start_time;
    ```

    ```bash
    +---------------------+---------------------+---------------+----------------+-----------------------------------+--------------------------------------------------------------------+
    | start_time          | end_time            | season_number | episode_number | episode_title                     | description                                                        |
    +---------------------+---------------------+---------------+----------------+-----------------------------------+--------------------------------------------------------------------+
    | 2023-11-12 19:00:00 | 2023-11-12 19:45:00 |             3 |              1 | 夜明けの出会い                    | 新しい都市での生活が始まる主人公の物語。                           |
    | 2023-11-12 19:00:00 | 2023-11-12 19:45:00 |             3 |              1 | 夜明けの出会い                    | 新しい都市での生活が始まる主人公の物語。                           |
    | 2023-11-12 21:00:00 | 2023-11-12 21:40:00 |             2 |              1 | 宇宙ステーションの日常            | 宇宙ステーションでの生活を紹介。                                   |
    | 2023-11-13 20:00:00 | 2023-11-13 20:45:00 |             3 |              2 | 過去の影                          | 主人公が過去の秘密に直面する。                                     |
    | 2023-11-14 18:30:00 | 2023-11-14 19:15:00 |             2 |              1 | 星への旅立ち                      | 若き宇宙飛行士が最初のミッションに挑む。                           |
    | 2023-11-15 21:00:00 | 2023-11-15 21:45:00 |             1 |              1 | 秘密の花園の発見                  | 古い屋敷の隠された花園を見つける物語。                             |
    | 2023-11-16 20:00:00 | 2023-11-16 20:45:00 |             4 |              1 | サイバー犯罪の謎                  | 高度なサイバー技術を使った犯罪に立ち向かう。                       |
    | 2023-11-17 19:30:00 | 2023-11-17 20:15:00 |             5 |              1 | 新しい地平へ                      | 海を越えた冒険の始まり。                                           |
    | 2023-11-18 22:00:00 | 2023-11-18 22:45:00 |             2 |              1 | 宇宙ステーションの日常            | 宇宙ステーションでの生活を紹介。                                   |
    +---------------------+---------------------+---------------+----------------+-----------------------------------+--------------------------------------------------------------------+
    9 rows in set (0.01 sec)
    ```

5. (advanced) 直近一週間で最も見られた番組が知りたいです。  
   直近一週間に放送された番組の中で、エピソード視聴数合計トップ2の番組に対して、番組タイトル、視聴数を取得してください  

    ```bash
    SELECT 
        p.title AS program_title,
        SUM(e.viewership) AS total_viewership
    FROM 
        broadcast_schedule bs
        JOIN episodes e ON bs.episode_id = e.episode_id
        JOIN series s ON e.series_id = s.series_id
        JOIN programs p ON s.series_id = p.series_id
    WHERE 
        bs.start_time BETWEEN CURDATE() - INTERVAL 7 DAY AND CURDATE()
    GROUP BY 
        p.title
    ORDER BY 
        total_viewership DESC
    LIMIT 2;
    ```

    ```bash
    +-----------------+------------------+
    | program_title   | total_viewership |
    +-----------------+------------------+
    | 夜明けの街      |           950000 |
    | 怪盗の謎        |           550000 |
    +-----------------+------------------+
    2 rows in set (0.13 sec)
    ```

6. (advanced) ジャンルごとの番組の視聴数ランキングを知りたいです。  
   番組の視聴数ランキングはエピソードの平均視聴数ランキングとします。  
   ジャンルごとに視聴数トップの番組に対して、ジャンル名、番組タイトル、エピソード平均視聴数を取得してください。  

    上記問題はわからなかったため、現在取り込み中です。
    ```bash
    SELECT 
        genre_name,title,viewership
    FROM 
        programs p
        JOIN genres g ON p.genres_id = g.genres_id
        JOIN series s ON p.series_id = s.series_id
        JOIN episodes e ON e.series_id = s.series_id
    WHERE 
        
    GROUP BY 
        
    ORDER BY 
    ```
 


